#include "display.h"
#include <avr/io.h>
#include <inttypes.h>
#include <util/delay.h>
#include <avr/pgmspace.h>
#include <char.h>
#include <stdlib.h>

void sendChar(uint8_t x,uint8_t y,uint8_t lx, uint8_t ly, const uint8_t Bstabe)
{
    sendbyte(WINDOW_STARTCOL,0);
    sendbyte(x,0);
    sendbyte(WINDOW_STARTPAGE,0);
    sendbyte(y,0);

    sendbyte(WINDOW_ENDCOL,0);
    sendbyte(x+lx-1,0);
    sendbyte(WINDOW_ENDPAGE,0);
    sendbyte(y+ly-1,0);

    sendbyte(WINDOW_ENABLE,0);

    uint8_t counter;
    uint8_t upper_limit =  pgm_read_byte(&(alphabet[Bstabe][1]))+2;



        for(counter = 2; counter < upper_limit ;counter++)
        {
            sendbyte(pgm_read_byte(&(alphabet[Bstabe][counter])),1);
        }

    sendbyte(WINDOW_DISABLE,0);
}

void print(const char *text,uint8_t x,uint8_t y)
{
	uint8_t counter = 0;
	uint8_t offset = 0;
	uint8_t y_move = y;
	uint8_t x_move = x;


	while(text[counter] != 0 )
	{
		uint8_t character = (uint8_t)text[counter];
		// 0 - 41 = 42
		if(character >=48 && character <= 57) offset = 45;  //stelle 3
		else if(character >=65 && character <= 90) offset = 51; // stelle 14 - > 39
		else if(character >=97 && character <= 122) offset = 83; // stelle 14 - > 39 keine klein B
		else if(character ==32) offset = 32;//space stelle 0
		else if(character ==43) offset = 42;//+	stelle 1
		else if(character ==45) offset = 43;//-  stelle 2
		else if(character ==58) offset = 45;//:  stelle 13
		else if(character ==95) offset = 55;//_   stelle 41
		else if(character ==124) offset = 83;//|	stelle 42
		else if(character ==47) offset = 5;//|	stelle 43 pfeil
		else if(character ==33){
			character = 43;
			offset =0;
		}//ausrufe
		else if(character == 36){
			character = 44;
			offset =0;
		}	//dollar
		else if(character == 37){
			character = 45;
			offset =0;
		}	//block

		sendChar(x_move,y_move,6,2,character - offset);

		if(character == 105 ||character == 73 || (character == 43 && offset == 0) ) x_move += 2;

		else x_move += 6;

		counter++;
		if(x_move >= 150)
		{
			y_move+= 3;
			x_move = x;
			if(y_move > 20) y_move = y;
 		}
	}
}

void printN(const uint16_t *number,uint8_t x,uint8_t y)
{
	char num[16];
	itoa(number, num, 10);
	print(num, x, y);
}

void printB(const uint16_t *number,uint8_t x,uint8_t y)
{
	char num[8];
	itoa(number, num, 2);
	print(num, x, y);
}

void print32(const uint32_t number,uint8_t x,uint8_t y)
{
	char num[32];
	itoa(number, num, 10);
	print(num, x, y);
}


const uint8_t alphabet[46][14] PROGMEM = {
{6,12, 	 // space.bmp Dez 32
0x0,0x0,0x0,0x0,0x0,0x0,
0x0,0x0,0x0,0x0,0x0,0x0},
{6,12, 	 //+.bmp Dec 43
0x0,0xc,0x0,0xc,0xc0,0xff,
0x0,0xc,0x0,0xc,0x0,0x0},
{6,12, 	 //-.bmp Dec 45
0x0,0xc,0x0,0xc,0x0,0xc,
0x0,0xc,0x0,0xc,0x0,0x0},
{6,12, 	 //0.bmp Dec 48
0xf0,0x3f,0xc,0xf0,0xc,0xcc,
0xc,0xc3,0xf0,0x3f,0x0,0x0},
{6,12, 	 //1.bmp
0xc,0xc0,0xfc,0xff,0x0,0xc0,
0x0,0x0,0x0,0x0,0x0,0x0},
{6,12, 	 //2.bmp
0x30,0xf0,0xc,0xcc,0xc,0xc3,
0xf0,0xc0,0x0,0x0,0x0,0x0},
{6,12, 	 //3.bmp
0xc,0xc0,0xc,0xc3,0xc,0xc3,
0xf0,0x3c,0x0,0x0,0x0,0x0},
{6,12, 	 //4.bmp
0xfc,0x3,0x0,0x3,0x0,0x3,
0xfc,0xff,0x0,0x0,0x0,0x0},
{6,12, 	 //5.bmp
0xfc,0xc3,0xc,0xc3,0xc,0xc3,
0xc,0xff,0x0,0x0,0x0,0x0},
{6,12, 	 //6.bmp
0xfc,0xff,0xc,0xc3,0xc,0xc3,
0xc,0xff,0x0,0x0,0x0,0x0},
{6,12, 	 //7.bmp
0xc,0x0,0xc,0xf0,0xc,0xf,
0xfc,0x0,0x0,0x0,0x0,0x0},
{6,12, 	 //8.bmp
0xfc,0xff,0xc,0xc3,0xc,0xc3,
0xfc,0xff,0x0,0x0,0x0,0x0},
{6,12, 	 //9.bmp  57
0xfc,0xc3,0xc,0xc3,0xc,0xc3,
0xfc,0xff,0x0,0x0,0x0,0x0},
{6,12, 	 //:.bmp  58
0xc0,0xf3,0xc0,0xf3,0x0,0x0,
0x0,0x0,0x0,0x0,0x0,0x0},
{6,12, 	 //A.bmp  65
0xf0,0xff,0xc,0xc,0xc,0xc,
0xc,0xc,0xf0,0xff,0x0,0x0},
{6,12, 	 //B.bmp
0xfc,0xff,0xc,0xc3,0xc,0xc3,
0xc,0xc3,0xf0,0x3c,0x0,0x0},
{6,12, 	 //C.bmp
0xf0,0x3f,0xc,0xc0,0xc,0xc0,
0xc,0xc0,0x0,0x0,0x0,0x0},
{6,12, 	 //D.bmp
0xfc,0xff,0xc,0xc0,0xc,0xc0,
0xc,0xc0,0xf0,0x3f,0x0,0x0},
{6,12, 	 //E.bmp
0xfc,0xff,0xc,0xc3,0xc,0xc3,
0xc,0xc3,0x0,0x0,0x0,0x0},
{6,12, 	 //F.bmp
0xfc,0xff,0xc,0x3,0xc,0x3,
0xc,0x3,0x0,0x0,0x0,0x0},
{6,12, 	 //G.bmp
0xf0,0x3f,0xc,0xc0,0xc,0xc0,
0xc,0xc3,0xc,0xff,0x0,0x0},
{6,12, 	 //H.bmp
0xfc,0xff,0x0,0x3,0x0,0x3,
0x0,0x3,0xfc,0xff,0x0,0x0},
{6,12, 	 //I.bmp
0xfc,0xff,0x0,0x0,0x0,0x0,
0x0,0x0,0x0,0x0,0x0,0x0},
{6,12, 	 //J.bmp
0x0,0xc0,0x0,0xc0,0x0,0xc0,
0x0,0xc0,0xfc,0x3f,0x0,0x0},
{6,12, 	 //K.bmp
0xfc,0xff,0x0,0x3,0xc0,0xc,
0x30,0x30,0xc,0xc0,0x0,0x0},
{6,12, 	 //L.bmp
0xfc,0xff,0x0,0xc0,0x0,0xc0,
0x0,0xc0,0x0,0xc0,0x0,0x0},
{6,12, 	 //M.bmp
0xfc,0xff,0x30,0x0,0xc0,0x0,
0x30,0x0,0xfc,0xff,0x0,0x0},
{6,12, 	 //N.bmp
0xfc,0xff,0x30,0x0,0xc0,0x0,
0x0,0x3,0xfc,0xff,0x0,0x0},
{6,12, 	 //O.bmp
0xf0,0x3f,0xc,0xc0,0xc,0xc0,
0xc,0xc0,0xf0,0x3f,0x0,0x0},
{6,12, 	 //P.bmp
0xfc,0xff,0xc,0xc,0xc,0xc,
0xc,0xc,0xf0,0x3,0x0,0x0},
{6,12, 	 //Q.bmp
0xf0,0x3f,0xc,0xc0,0xc,0xc0,
0xc,0xc0,0xf0,0x3f,0x0,0xc0},
{6,12, 	 //R.bmp
0xfc,0xff,0xc,0xc,0xc,0xc,
0xc,0xc,0xf0,0xf3,0x0,0x0},
{6,12, 	 //S.bmp
0xf0,0xc0,0xc,0xc3,0xc,0xc3,
0xc,0xc3,0xc,0x3c,0x0,0x0},
{6,12, 	 //T.bmp
0xc,0x0,0xc,0x0,0xfc,0xff,
0xc,0x0,0xc,0x0,0x0,0x0},
{6,12, 	 //U.bmp
0xfc,0x3f,0x0,0xc0,0x0,0xc0,
0x0,0xc0,0xfc,0x3f,0x0,0x0},
{6,12, 	 //V.bmp
0xfc,0xf,0x0,0x30,0x0,0xc0,
0x0,0x30,0xfc,0xf,0x0,0x0},
{6,12, 	 //W.bmp
0xfc,0xff,0x0,0x30,0x0,0xc,
0x0,0x30,0xfc,0xff,0x0,0x0},
{6,12, 	 //X.bmp
0x3c,0xf0,0xc0,0xc,0x0,0x3,
0xc0,0xc,0x3c,0xf0,0x0,0x0},
{6,12, 	 //Y.bmp
0xfc,0x0,0x0,0x3,0x0,0xff,
0x0,0x3,0xfc,0x0,0x0,0x0},
{6,12, 	 //Z.bmp  90
0xc,0xf0,0xc,0xcc,0xc,0xc3,
0xcc,0xc0,0x3c,0xc0,0x0,0x0},
{6,12, 	 //_.bmp  95
0x0,0xc0,0x0,0xc0,0x0,0xc0,
0x0,0xc0,0x0,0xc0,0x0,0x0},
{6,12, 	 //|.bmp dec 124
0x0,0x0,0x0,0x0,0xff,0xff,
0x0,0x0,0x0,0x0,0x0,0x0},
{6,12, 	 //arrow.bmp
0x0,0x7,0x0,0x7,0x0,0x7,
0xc0,0x1f,0x0,0x7,0x0,0x1},
{6,12, 	 //!.bmp   ascii 33
0xfc,0xcf,0x0,0x0,0x0,0x0,
0x0,0x0,0x0,0x0,0x0,0x0},
{6,12, 	 //$.bmp	36
0x30,0xc,0xcc,0x30,0xff,0xff,
0xc,0x33,0x30,0xc,0x0,0x0},
{6,12, 	 //%.bmp block	37
0xfc,0xff,0xfc,0xff,0xfc,0xff,
0xfc,0xff,0xfc,0xff,0x0,0x0},

};


